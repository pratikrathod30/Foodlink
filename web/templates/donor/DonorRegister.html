{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/DonorLogin.css' %}">

<div class="donor-login-wrapper">
  <div class="donor-login-container">

    <!-- LEFT -->
    <div class="donor-login-left">
      <div class="brand-badge">
        <img src="{% static 'images/logo.png' %}" alt="FoodLink Logo">
      </div>

      <h1>Become a Food Donor</h1>
      <p class="left-desc">
        Join FoodLink and help reduce food waste by donating surplus food
        to verified NGOs and communities.
      </p>

      <ul class="left-points">
        <li>List surplus food easily</li>
        <li>Track donations in real-time</li>
        <li>Make measurable social impact</li>
      </ul>
    </div>

    <!-- RIGHT -->
    <div class="donor-login-right">
      <h2>Donor Registration</h2>
      <p class="login-subtext">Create your donor account</p>

      <p id="errorMsg" style="color:red; display:none;"></p>

      <form class="donor-login-form" id="registerForm">
        <div class="form-group">
          <label>Restaurant / Event Name</label>
          <input name="name" type="text" placeholder="Enter your name" required>
        </div>

        <div class="form-group">
          <label>Email</label>
          <input name="email" type="email" placeholder="Enter your email" required>
        </div>

        <div class="form-group">
          <label>Password</label>
          <input name="password" type="password" placeholder="Create a password" required>
        </div>

        <div class="form-group">
          <label>Confirm Password</label>
          <input name="confirmPassword" type="password" placeholder="Confirm password" required>
        </div>

        <button type="submit" class="donor-login-btn">
          Register as Donor
        </button>
      </form>

      <div class="donor-login-footer">
        Already a donor?
        <span onclick="location.href='/donor/login/'">
          Login here
        </span>
      </div>
    </div>

  </div>
</div>

<script>
document.getElementById("registerForm").onsubmit = async function(e) {
  e.preventDefault();

  const form = e.target;
  const errorBox = document.getElementById("errorMsg");

  errorBox.style.display = "none";

  if (form.password.value !== form.confirmPassword.value) {
    errorBox.innerText = "Passwords do not match";
    errorBox.style.display = "block";
    return;
  }

  const res = await fetch("/api/register/donor/", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      name: form.name.value,
      email: form.email.value,
      password: form.password.value
    })
  });

  if (!res.ok) {
    const data = await res.json();
    errorBox.innerText = data.error || "Something went wrong";
    errorBox.style.display = "block";
    return;
  }

  location.href = "/donor/login/";
};
</script>

{% endblock %}
